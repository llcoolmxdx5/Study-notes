# 03-5-特效

## 1.拖拽

```js
<div class="d-box" id="d_box">
  <div class="hd" id="drop">注册信息 (可以拖拽)
    <span id="box_close">【关闭】</span>
  </div>
  <div class="bd"></div>
</div>
var box = document.getElementById('d_box');
var drop = document.getElementById('drop');
drop.onmousedown = function (e) {
  e = e || window.event;// 兼容性处理
  // 当鼠标按下的时候，求鼠标在盒子中的位置
  // 鼠标在盒子中的位置 = 鼠标在页面上的位置 - 盒子的位置
  var x = getPage(e).pageX - box.offsetLeft;
  var y = getPage(e).pageY - box.offsetTop;
  // 鼠标在文档中移动
  document.onmousemove = function (e) {
    e = e || window.event;
    // 当鼠标在页面上移动的时候。求盒子的坐标
    // 盒子的坐标 = 鼠标当前在页面中的位置 - 鼠标在盒子中的位置
    var boxX = getPage(e).pageX - x;
    var boxY = getPage(e).pageY - y;
    box.style.left = boxX + 'px';
    box.style.top = boxY + 'px';
  }
}
// 当鼠标弹起的时候，移除鼠标移动事件
document.onmouseup = function () {
  document.onmousemove = null;
}
// 点击关闭按钮，隐藏盒子
var box_close = document.getElementById('box_close');
box_close.onclick = function () {
  box.style.display = 'none';
}
```

## 2. 弹出层

```js
<div class="login-header"><a id="link" href="javascript:void(0);">点击，弹出登录框</a></div>
<div id="login" class="login" >...</div>
<div id="bg" class="login-bg" ></div> //遮盖层
// 显示登录框和遮盖层
var login = document.getElementById('login');
var bg = document.getElementById('bg');
//1 点击按钮，弹出登录框和遮盖层
var link = document.getElementById('link');
link.onclick = function () {
  login.style.display = 'block';
  bg.style.display = 'block';
  return false;
}
// 2 点击关闭按钮，隐藏 登录框和遮盖层
var closeBtn = document.getElementById('closeBtn');
closeBtn.onclick = function () {
  // 隐藏 登录框和遮盖层
  login.style.display = 'none';
  bg.style.display = 'none';
}
```

## 3. 放大镜

```js
<div class="box" id="box">
  <div class="small">
      <img src="images/small.jpg" width="350" alt=""/>
      <div class="mask"></div>
  </div>
  <div class="big">
      <img src="images/big.jpg" width="800" alt=""/>
  </div>
</div>
<script>
  var box = document.getElementById('box');
  var smallBox = box.children[0];
  var bigBox = box.children[1];
  var smallImage = smallBox.children[0];
  var mask = smallBox.children[1];
  var bigImage = bigBox.children[0];
  // 1 鼠标经过的时候 显示 mask和bigBox ， 当鼠标离开box的时候隐藏mask和bigBox
  // mouseenter   mouseleave     不会触发事件冒泡
  // mouseover   mouseout        会触发事件冒泡
  box.onmouseenter = function () {
    // 显示 mask和bigBox
    mask.style.display = 'block';
    bigBox.style.display = 'block'
  }
  box.onmouseleave = function () {
    mask.style.display = 'none';
    bigBox.style.display = 'none';
  }
  // 2 当鼠标在盒子中移动的时候，让mask和鼠标一起移动
  box.onmousemove = function (e) {
    e = e || window.event;
    // 获取鼠标在盒子中的位置，就是mask的坐标
    var maskX = getPage(e).pageX - box.offsetLeft;
    var maskY = getPage(e).pageY - box.offsetTop;
    // 让鼠标出现在mask的中心点
    maskX = maskX - mask.offsetWidth / 2;
    maskY = maskY - mask.offsetHeight / 2;
    // 把mask限制到box中
    maskX = maskX < 0 ? 0 : maskX;
    maskY = maskY < 0 ? 0 : maskY;
    maskX = maskX > box.offsetWidth - mask.offsetWidth ? box.offsetWidth - mask.offsetWidth : maskX;
    maskY = maskY > box.offsetHeight - mask.offsetHeight ? box.offsetHeight - mask.offsetHeight : maskY;
    mask.style.left = maskX + 'px';
    mask.style.top = maskY + 'px';
    // 3 当mask移动的时候，让大图片移动
    // 求 大图片移动的距离
    // mask移动的距离 / mask最大能够移动的距离  = 大图片移动的距离 / 大图片最大能够移动的距离
    // mask最大能够移动的距离
    var maskMax = box.offsetWidth - mask.offsetWidth;
    // 大图片最大能够移动的距离
    var bigImageMax = bigImage.offsetWidth - bigBox.offsetWidth;
    var bigImageX = maskX * bigImageMax / maskMax;
    var bigImageY = maskY * bigImageMax / maskMax;
    bigImage.style.left = -bigImageX + 'px';
    bigImage.style.top = -bigImageY + 'px';
  }
</script>
```

## 4. 模拟滚动条

```html
<div class="box" id="box">
  <div class="content" id="content">
    大量内容在此
  </div>
  <div class="scroll" id="scroll">
      <div class="bar" id="bar"></div>
  </div>
</div>
<script>
  var box = document.getElementById('box')
  var content = document.getElementById('content');
  var scroll = document.getElementById('scroll');
  var bar = document.getElementById('bar');
  //1 根据内容的大小，计算滚动条的高度
  //  滚动条的高度 / scroll的高度 = box的高度 / 内容的高度
  // offsetHeight     元素的大小 + padding + border
  // clientHeight     元素的大小 + padding
  // scrollHeight     内容的大小 + padding
  // 当内容的高度大于box的高度，再计算 滚动条的高度，否则的话滚动条的高度为0
  var barHeight = 0;
  if (content.scrollHeight > box.clientHeight) {
    barHeight = box.clientHeight / content.scrollHeight * scroll.clientHeight;
  }
  bar.style.height = barHeight + 'px';
  //2 让滚动条能够拖拽
  // 2.1 当鼠标按下的时候，求鼠标在滚动条中的位置
  bar.onmousedown = function (e) {
    e = e || window.event;
    // 鼠标在滚动条中的位置
    var y = getPage(e).pageY - bar.offsetTop - box.offsetTop;
    // 2.2 当鼠标在页面上移动的时候，求滚动条的位置
    document.onmousemove = function (e) {
        var barY = getPage(e).pageY - y - box.offsetTop;//求滚动条的位置
        // 控制bar不能移除scroll
        barY = barY < 0 ? 0 : barY;
        barY = barY > scroll.clientHeight - bar.clientHeight ? scroll.clientHeight - bar.clientHeight : barY;
        bar.style.top = barY + 'px';
        //3 当拖拽滚动条的时候，改变内容的位置
        // 内容滚动的距离 / 内容最大能够滚动的距离 = 滚动条滚动的距离 / 滚动条最大能够滚动的距离
        var contentMax = content.scrollHeight - box.clientHeight;// 内容最大能够滚动的距离
        var barMax = scroll.clientHeight - bar.clientHeight; // 滚动条最大能够滚动的距离
        var contentY = barY / barMax * contentMax;
        content.style.top = -contentY + 'px';
    }
  }
  document.onmouseup = function () {
    document.onmousemove = null;// 移除鼠标移动的事件
  }
</script>
```

## 5. 回到顶部

```js
function my$(id) {
  return document.getElementById(id);
}
// 获取页面滚动距离的浏览器兼容性问题
// 获取页面滚动出去的距离
function getScroll() {
  var scrollLeft = document.body.scrollLeft || document.documentElement.scrollLeft;
  var scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
  return {
    scrollLeft: scrollLeft,
    scrollTop: scrollTop
  };
}
var bodyTop = my$('top');// 获取元素
var totop = my$('totop');// 回到顶部的按钮
// 当拖动滚动条的时候执行
window.onscroll = function () {
  //1 当拖动滚动条的时候，当内容滚动出去 10px的时候，改变top的高度，并且显示回到顶部按钮
  // 调用common.js getScroll函数，获取页面滚动出去的距离
  var scrollTop = getScroll().scrollTop;
  if (scrollTop > 10) {
    bodyTop.className = 'header fixed';// 改变top
    totop.style.display = 'block';// 显示回到顶部
  } else {
    bodyTop.className = 'header';// 不改变top
    totop.style.display = 'none';// 不显示回到顶部
  }
  // 如何获取滚动距离
  // document.body.scrollTop
  // documentElement  网页中的根元素 html
  // document.documentElement.scrollTop
};
var timerId = null;//2 当点击回到顶部按钮的时候，动画的方式，回到最上面，让滚动距离为0
totop.onclick = function () {
  if (timerId) {
    clearInterval(timerId);
    timerId = null;
  }
  timerId = setInterval(function () {
    var step = 10;// 步进 每次移动的距离
    var target = 0;// 目标位置
    var current = getScroll().scrollTop;// 获取当前位置
    if (current > target) {
      step = -Math.abs(step);
    }
    // 判断当前是否到达目标位置
    if (Math.abs(current - target) <= Math.abs(step)) {
      clearInterval(timerId);
      document.body.scrollTop = target;
      document.documentElement.scrollTop = target;
      return;
    }
    current += step;
    document.body.scrollTop = current;
    document.documentElement.scrollTop = current;
  }, 5);
};
```
